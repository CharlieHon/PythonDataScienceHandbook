# Ipython: Beyond Normal Python

## 1.1 启动IPython

打开`cmd`命令行输入`ipython`打开`IPython`(interactive Python)

## 1.2 Ipython 中的帮助文档

- `?` 查询文档
- `??` 查看源代码
- `Tab` 自动填充

每个 Python 对象都包含字符串说明文档，是对类的简介概述以及如何使用，也称为 `doc string`。使用Python内置的 `help()` 函数可以得到这个文档。

```Bash
help(len)
```

### 1.2.1 用符号 ? 获取文档

因为帮助文档很常用，所以IPython可以通过 `?` 快捷查看帮助文档

```Ipython
len?
```

使用 `?` 的方式在很多情况下都有用，包括对象方法。

![帮助文档](https://pic4.zhimg.com/80/v2-2024ed212779c044419eae8eb957b642.png)

自定义函数或者对象同样可以适用

![自定义函数帮助文档](https://pic4.zhimg.com/80/v2-61559c239ec3c1b9f848dbe1175586dc.png)

### 1.2.2 通过 ?? 获取源代码

`Ipython` 中可以通过 `??` 查看源代码

![查看源代码](https://pic4.zhimg.com/80/v2-9d7866229f17c165596e30ac545211a7.png)

如果函数不是通过Python而是C或其他编译语言实现的，则通过 `??` 获取的内容与 `?` 一致。例如 `len`:

![len??](https://pic4.zhimg.com/80/v2-e22957d9b7cb27772da42b7bd388b0a3.png)

### 1.2.3 用 Tab 补全的方式探索模块

`Ipython` 另一个常用的交互是通过 `Tab` 键进行**自动填充**

每个Python对象都有相关的或多或少的属性和方法，Python的内置函数 `dir` 可以返回对象属性的列表。通过输入对象，接着输入一个点 `.`，再按下 `Tab` 键后就会显示对象的所有属性和方法。

![Tab填充](https://pic4.zhimg.com/80/v2-db6e17255e958c557296f39f3633b9ce.png)

对象的私有属性/方法(以双下划线开头`__`)默认情况下会被列表省略，但可以通过显式键入下划线来列出它们。

![私有属性/方法](https://pic4.zhimg.com/80/v2-e8871e1667e64fcc9bc890453c2799a1.png)

在导入 `import` 时使用 `Tab` 键可以查看能导入的模块

![Tab查看可导入模块](https://pic4.zhimg.com/80/v2-3e66bc87ee505cb5ea11bc7495ecbf6c.png)

输入 `import` 再按下 `Tab` 键可以查看系统可以导入的模块

如果你只知道对象或属性的中间或结尾的单词，就无法使用 `Tab` 进行补全。这时可以使用通配符 `*` 进行匹配。例如我们可以使用通配符列出命名空间中以 `Warning` 结尾的所有对象：

![通配符匹配](https://pic4.zhimg.com/80/v2-d5579845f441de81ff79c95ac09375ef.png)

> 注意：`*` 通配符匹配所有字符串包括空字符串。

例如，查找 `str` 对象中包含 `find` 单词的所有方法，如下：

![通配符匹配](https://pic4.zhimg.com/80/v2-c32f2413aae15ca9e526ec296197d1b0.png)

## 1.3 Ipython Shell 中的快捷键

这些快捷键并不是 IPython 本身提供的，而是通过 IPython 对 GNU Readline 库的依赖关系实现的。因此，以下快捷键可能会因为系统配置的不同而不同。

### 1.3.1 导航快捷键

| 快捷键               | 动作                     |
| -------------------- | ------------------------ |
| `Ctrl+a`             | 将光标移动到本行的开始处 |
| `Ctrl+e`             | 将光标移动到本行的结尾处 |
| `Ctrl+b`(或左箭头键) | 将光标回退一个字符       |
| `Ctrl+f`(或右箭头键) | 将光标前进一个字符                         |

### 1.3.2 文本输入快捷键

| 快捷键        | 动作                     |
| ------------- | ------------------------ |
| `Backspace键` | 删除前一个字符           |
| `Ctrl+d`      | 删除后一个字符           |
| `Ctrl+k`      | 从光标开始剪切至行的末尾 |
| `Ctrl+u`      | 从行的开头剪切至光标     |
| `Ctrl+y`      | yank(即粘贴)之前的文本   |
| `Ctrl+t`      | transpose(即交换)前两个字符                         |

### 1.3.3 命令历史快捷键

| 快捷键             | 动作               |
| ------------------ | ------------------ |
| `Ctrl+p`(或向上箭头) | 获取前一个历史命令 |
| `Ctrl+n`(或向下箭头) | 获取后一个历史命令 |
| `Ctrl+r`          | **对历史命令的反向搜索**                   |

反向搜索特别有用，`Ctrl+r` 后在提示符后开始输入字符，IPython将自动填充时间最近的命令。可以随时添加更多的字符来重新定义搜索，或者**再一次按下 `Ctrl+r` 键来寻找另外一个匹配该查询的命令**。找到在寻找的命令后，按下回车键将会终止查询。

### 1.3.4 其他快捷键

| 快捷键   | 动作                 |
| -------- | -------------------- |
| `Ctrl+l` | 清除终端屏幕的内容   |
| `Ctrl+c` | 中断当前的Python命令 |
| `Ctrl+d` | 退出IPython会话                     |

## 1.4 Ipython魔法命令

Ipython在普通Python语法基础之上的增强功能，被称作`IPython魔法命令` 并且都以 `%` 符号作为**前缀**。这些魔法命令设计用于简洁地解决标准数据分析中的各种常见问题。

魔法命令有两种形式：

- 行魔法(line magic)以**单个 `%` 字符**作为前缀，作用于**单行输入**。
- 单元魔法(cell magic)以两个 `%%` 作为前缀，作用于**多行输入**。

### 1.4.1 粘贴代码块：`%paste` 和 `%cpaste`

当使用IPython解释器时，粘贴多行代码块可能会导致不可预料的错误，尤其是其中包含缩进和解释符号时。在直接粘贴的过程中，解释器被额外的提示符号搞晕。使用Ipython的 `%paste` 魔法函数可以解决这个包含符号的多行输入问题：

```python
def f(a):
    return a ** 4
```

复制上述代码，在Ipython中输入 `%paste` 命令会**同时输入并执行该代码**。

`%cpaste`命令**打开一个交互式多行输入提示，可以在提示下粘贴并执行一个或多个代码块**。粘贴后回车换行，输入 `--` 运行粘贴的代码块。

![%cpaste](https://pic4.zhimg.com/80/v2-7c319cd5c03006fe91e3cb700c324833.png)

### 1.4.2 执行外部代码: %run

在IPython中运行文本编辑器存储的代码，可以通过 `%run` 魔法命令来实现。运行代码之后，其中包含的所有函数都可以在IPython会话中使用：

![%run](https://pic4.zhimg.com/80/v2-31e40816a35257624670c8225e9b347c.png)

IPython提供了几种方式来调整代码如何执行，可以在IPython解释器中输入 `%run?` 查看帮助文档。

### 1.4.3 计算代码运行时间: %timeit

`%timeit` 魔法函数，会自动计算接下来一行的Python语句的执行时间。它会自动多次执行简短的命令，以获取更稳定的结果。

对于多行语句，可以加入第二个 `%` 符号将其转变成单元魔法，以处理多行输入。

![%timeit](https://pic4.zhimg.com/80/v2-40b4d4817ac7c9dee134375a6d14889a.png)

### 1.4.4 魔法函数的帮助: ?、%magic和%lsmagic

和普通的Python函数一样，IPython魔法函数也有文档字符串，并且可以通过标准的方式获取这些有用的文档注释。

- 查看 `%timeit` 魔法函数的文档注释     `%timeit?`
- 获取可用魔法函数的通用描述以及一些示例    `%magic`
- 快速而简单地获得所有可用魔法函数地列表    `%lsmagic`

## 1.5 输入和输出历史

IPython在shell和Notebook中都提供了几种获取历史命令分输出方式，以及这些命令本省地字符串形式。

### 1.5.1 IPython地输入和输出对象

IPython实际上创建了叫作 `In` 和 `Out` 地Python变量，这些变量自动更新以反应命令历史。

- `In` 对象是一个列表，按照顺序记录所有命令(列表中地第一项是一个占位符，以便`In[1]` 可以表示第一条命令)
- `Out` 对象不是一个列表，而是一个**字典**。将输入数字映射到相应地输出(如果有地话)。

> 注意：**不是所有操作都有输出**。例如 `import` 和 `print` 语句就不影响输出。`print` 函数返回值是 `None` ，**任何返回值是`None`地命令都不会加到`Out`变量中**。

![In/Out对象](https://pic4.zhimg.com/80/v2-1054576761d0a7646ae8044f3d70d95c.png)

### 1.5.2 下划线快捷键和以前的输出

标准的`Python shell`仅仅包括一个 用于获取以前输出的简单快捷键，变量`_`(单下划线)用于更新以前的输出。

这种方式在IPython中也适用，但在IPython中可以更进一步，可以用两条下划线获得倒数第二个历史输出，用三条下划线获得倒数第三个历史输出(跳过没有任何输出的命令):

![下划线快捷键](https://pic4.zhimg.com/80/v2-e331208ee9340690646d69e05693d7ac.png)

### 1.5.3 禁止输出

有时希望禁止一条语句的输出，或者执行的命令生成了一个你不希望存储到输出命令中的结果，这样当其他引用被删除时，该空间可以被释放。

要禁止一个命令的输出，最简单的方式就是在行末尾处添加一个分号`;`。结果被默认地计算了，并且输出结果既不会显示在屏幕上，也不会存储在`Out`路径下：

![禁止输出](https://pic4.zhimg.com/80/v2-dbac7408b7b843b834f8b93b513a3471.png)

### 1.5.4 相关的魔法命令

如果想一次性获取此前所有的输出历史，`%history`魔法命令会非常有用。如下示例可以看到如何打印前4条输出命令(-n选项用于显示行号)：

```Bash
%history -n 1-4
```

同理，可以输入`%history?`来查看更多相关信息以及可用选项的详细描述。其他类似的魔法命令还有`%run`(该命令将重新执行部分历史命令)和`%save`(该命令将部分历史命令保存到一个文件中)。

![%save](https://pic4.zhimg.com/80/v2-2a935702ff16d12632bae189371c4bad.png)
